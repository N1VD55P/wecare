<!-- views/nurseportal.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nurse Dashboard</title>
  <link rel="stylesheet" href="/css/nurseportal.css">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Playwrite+AU+VIC+Guides&display=swap" rel="stylesheet">
</head>
<body>
  <main class="main-content">
    <header class="top-bar">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div>
          <h2>Welcome, <%= typeof nurse !== 'undefined' ? nurse.name : 'Meera' %>!</h2>
          <p>You have <%= typeof appointmentCount !== 'undefined' ? appointmentCount : '3' %> appointments today | <a href="/" style="color: white; text-decoration: none;">Home</a> | <a href="/logout" style="color: rgb(255, 0, 0); text-decoration: none;">Logout</a></p>
        </div>
        <a href="/nurse/edit-profile" style="background-color: #4CAF50; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold; white-space: nowrap; margin-left: 20px;">Edit My Profile</a>
      </div>
    </header>

    <section class="stats">
      <% 
      const stats = typeof nurseStats !== 'undefined' ? nurseStats : {
        earnings: '0',
        pendingRequests: '0',
        hoursWorked: '0',
        rating: '4.9'
      };
      %>
      
      <div class="stat-card">
        <h3>Rs.<%= stats.earnings %>/hr</h3>
        <p>Hourly Rate</p>
      </div>
      <div class="stat-card">
        <h3><%= stats.pendingRequests %></h3>
        <p>Pending Requests</p>
      </div>
      <div class="stat-card">
        <h3><%= stats.hoursWorked %></h3>
        <p>Experience</p>
      </div>
      <div class="stat-card">
        <h3><%= stats.rating %></h3>
        <p>Rating</p>
      </div>
    </section>

    <section class="content-grid">
      <div class="appointments">
        <h3>Today's Appointments</h3>
        <% 
        // Get appointments from nurse history
        const todayAppointments = (nurse.history || [])
          .filter(h => h.category === 'appointment')
          .slice(0, 3)
          .map((apt, idx) => ({
            patient: apt.notes || 'Patient ' + (idx + 1),
            service: apt.meta?.service || 'Nursing Care',
            time: apt.meta?.time || '9:00 AM - 11:00 AM',
            color: ['blue', 'green', 'purple'][idx % 3],
            initials: (apt.notes || 'P').substring(0, 2).toUpperCase()
          }));
        
        // If no appointments, show sample
        if (todayAppointments.length === 0) {
          todayAppointments.push(
            { patient: 'No appointments scheduled', service: 'Check back later', time: '--', color: 'blue', initials: 'NA' }
          );
        }
        %>
        
        <% todayAppointments.forEach(appointment => { %>
          <div class="appointment-card <%= appointment.color %>">
            <span class="avatar"><%= appointment.initials %></span>
            <div>
              <h4><%= appointment.patient %></h4>
              <p><%= appointment.service %></p>
              <span><%= appointment.time %></span>
            </div>
            <button class="navigate-btn">Navigate</button>
          </div>
        <% }); %>
      </div>

      <div class="right-side">
        <div class="pending">
          <h3>Pending Requests</h3>
          <% 
          const pendingRequests = (nurse.history || [])
            .filter(h => h.category === 'pending')
            .slice(0, 2)
            .map((req, idx) => ({
              patient: req.notes || 'Patient ' + (idx + 1),
              service: req.meta?.service || 'Care Service',
              time: req.meta?.time || 'Tomorrow 10:00 AM'
            }));
          
          if (pendingRequests.length === 0) {
            pendingRequests.push(
              { patient: 'No pending requests', service: 'All caught up!', time: '--' }
            );
          }
          %>
          
          <% pendingRequests.forEach(request => { %>
            <div class="pending-card">
              <h4><%= request.patient %></h4>
              <p><%= request.service %> â€“ <%= request.time %></p>
              <div class="actions">
                <button class="accept">Accept</button>
                <button class="decline">Decline</button>
              </div>
            </div>
          <% }); %>
        </div>

        <div class="earnings">
          <h3>Earnings Summary</h3>
          <% 
          const earnings = typeof nurseEarnings !== 'undefined' ? nurseEarnings : {
            week: '0',
            month: '0',
            pending: '0'
          };
          %>
          
          <p>This Week <span>Rs.<%= earnings.week %></span></p>
          <p>This Month <span>Rs.<%= earnings.month %></span></p>
          <p class="pending-pay">Pending Payment <span>Rs.<%= earnings.pending %></span></p>
          <button class="details-btn">View Details</button>
        </div>
      </div>
    </section>
  </main>

  <%- include('partials/footer') %>

  <script src="/js/nurseportal.js"></script>
</body>
</html>